<Window x:Class="repairshop_client.WindowMain"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:local="clr-namespace:repairshop_client"
	xmlns:fdg="http://filterdatagrid.control.com/2021"  
	mc:Ignorable="d"
	Height="450" Width="800"
	WindowState="Minimized"
	WindowStartupLocation="CenterScreen"
	d:DataContext="{d:DesignInstance Type=local:WindowMainViewModel}"
	Language="ru-RU"
	Title="Автомастерская" Loaded="Window_Loaded" Closing="Window_Closing" >
	<Window.Resources>
		<Style TargetType="DataGrid">
			<Setter Property="CanUserResizeRows" Value="False"/>
			<Setter Property="AlternatingRowBackground" Value="LightGray" />
		</Style>
		<CollectionViewSource x:Key="CollectionViewSourceClients" Source="{Binding Clients}" />
		<CollectionViewSource x:Key="CollectionViewSourceCars" Source="{Binding Cars}" />
		<CollectionViewSource x:Key="CollectionViewSourceMechanics" Source="{Binding Mechanics}" />
		<CollectionViewSource x:Key="CollectionViewSourceServices" Source="{Binding Services}" />
	</Window.Resources>
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="auto" />
			<RowDefinition Height="*" />
		</Grid.RowDefinitions>
		<Menu Grid.Row="0">
			<MenuItem 
				Click="ButtonAuthClick"
				Header="Авторизация" 
			/>
			<MenuItem 
				Click="ButtonSaveClick"
				Header="Сохранить"
			/>
			<MenuItem 
				Click="ButtonDropClick"
				Header="Сбросить изменения"
			/>
			<MenuItem 
				Click="ButtonCloseClick"
				Header="Выход" 
			/>
		</Menu>
		<TabControl 
			Grid.Row="1"
			x:Name="Tabs"
			IsEnabled="False" VerticalContentAlignment="Stretch"
			>
			<TabItem Header="Клиенты">
				<fdg:FilterDataGrid
					AutoGenerateColumns="False"
					ShowStatusBar="True"
					ShowElapsedTime="True"
					EnableRowVirtualization="True"
					Loaded="DataGrid_Loaded"
					PersistentFilter="True"
					ItemsSource="{Binding Clients}" >
					<fdg:FilterDataGrid.Columns>
						<fdg:DataGridTextColumn IsColumnFiltered="True" Header="Фамилия" Binding="{Binding Surname}"/>
						<fdg:DataGridTextColumn IsColumnFiltered="True" Header="Имя" Binding="{Binding Name}"/>
						<fdg:DataGridTextColumn IsColumnFiltered="True" Header="Отчество" Binding="{Binding Patronim}"/>

						<!--TODO: Должно быть числовое поле-->
						<fdg:DataGridTextColumn IsColumnFiltered="True" Header="Телефон" Binding="{Binding Phone}" MaxWidth="100"/>
						<fdg:DataGridTextColumn IsColumnFiltered="True" Header="Почта" Binding="{Binding Email}" Width="*"/>
					</fdg:FilterDataGrid.Columns>
				</fdg:FilterDataGrid>
			</TabItem>
			<TabItem Header="Механики">
				<DataGrid 
					AutoGenerateColumns="False"
					Loaded="DataGrid_Loaded"
					EnableRowVirtualization="True"
					ItemsSource="{Binding Source={StaticResource CollectionViewSourceMechanics}}">
					<DataGrid.Columns>
						<DataGridTextColumn Header="Фамилия" Binding="{Binding Surname}" Width="*"/>
						<DataGridTextColumn Header="Имя" Binding="{Binding Name}" Width="*"/>
						<DataGridTextColumn Header="Отчество" Binding="{Binding Patronim}" Width="*"/>

						<!--TODO: Должно быть числовое поле-->
						<DataGridTextColumn Header="Квалификация" Binding="{Binding Qualification}" MaxWidth="100"/>

					</DataGrid.Columns>
				</DataGrid>
			</TabItem>
			<TabItem Header="Услуги">
				<DataGrid
					EnableRowVirtualization="True"
					Loaded="DataGrid_Loaded"
					AutoGenerateColumns="False"
					ItemsSource="{Binding Source={StaticResource CollectionViewSourceServices}}">
					<DataGrid.Columns>
						<DataGridTextColumn Header="Название услуги" Binding="{Binding Name}" Width="*"/>
						
						<!--TODO: Должно быть числовое поле-->
						<DataGridTextColumn Header="Стоимость" 
							Binding="{Binding Price}" Width="100" MaxWidth="100"/>
					</DataGrid.Columns>
				</DataGrid>
			</TabItem>
			<TabItem Header="Машины">
				
				<DataGrid
					Loaded="DataGrid_Loaded"
					EnableRowVirtualization="True"
					AutoGenerateColumns="False"
					ItemsSource="{Binding Source={StaticResource CollectionViewSourceCars}}" >
					<DataGrid.Columns>
						<DataGridTextColumn Header="Производитель" Binding="{Binding Brand}"/>
						<DataGridTextColumn Header="Модель" Binding="{Binding Model}"/>
						
						<!--TODO: Должно быть числовое поле-->
						<DataGridTextColumn Header="Год" Binding="{Binding Year}" MaxWidth="42"/>
						<DataGridTextColumn Header="Номер" Binding="{Binding Plate}" MaxWidth="80"/>
						
						<!--TODO: тормозное решение-->
						<DataGridComboBoxColumn 
							Header="Владелец"
							ItemsSource="{Binding Source={StaticResource CollectionViewSourceClients}}"
							SelectedValueBinding="{Binding Client}"
							SortMemberPath="Client.Surname"
							Width="*"/>
					</DataGrid.Columns>
				</DataGrid>
			</TabItem>
			<TabItem Header="Ремонты">
				<DataGrid
					Loaded="DataGrid_Loaded"
					EnableRowVirtualization="True"
					AutoGenerateColumns="False"
					ItemsSource="{Binding Repairs}" >
					<DataGrid.Columns>
						<DataGridComboBoxColumn 
							Header="Машина"
							ItemsSource="{Binding Source={StaticResource CollectionViewSourceCars}}"
							SelectedValueBinding="{Binding Car}"
							SortMemberPath="Car.Brand"
							Width="*"/>
						<DataGridComboBoxColumn 
							Header="Механик"
							ItemsSource="{Binding Source={StaticResource CollectionViewSourceMechanics}}"
							SelectedValueBinding="{Binding Mechanic}"
							SortMemberPath="Mechanic.Surname"
							Width="*"/>
						<DataGridComboBoxColumn 
							Header="Услуга"
							ItemsSource="{Binding Source={StaticResource CollectionViewSourceServices}}"
							SelectedValueBinding="{Binding Service}"
							SortMemberPath="Service.Name"
							Width="*"/>
						
						<!--TODO: календарики-->
						<DataGridTextColumn Header="Дата начала" Binding="{Binding DateStart}"/>
						<DataGridTextColumn Header="Дата окончания" Binding="{Binding DateEnd}"/>
						
						<!--Source - https://stackoverflow.com/a
						<Posted by jimSampica
						<Retrieved 2026-01-18, License - CC BY-SA 3.0-->
						<!--<DataGridTemplateColumn Header="Pick a Date">
							<DataGridTemplateColumn.CellTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding DateEnd}" />
								</DataTemplate>
							</DataGridTemplateColumn.CellTemplate>
							<DataGridTemplateColumn.CellEditingTemplate>
								<DataTemplate>
									<DatePicker SelectedDate="{Binding DateEnd}" />
								</DataTemplate>
							</DataGridTemplateColumn.CellEditingTemplate>
						</DataGridTemplateColumn>-->

					</DataGrid.Columns>
					</DataGrid>
			</TabItem>
		</TabControl>
	</Grid>
</Window>
